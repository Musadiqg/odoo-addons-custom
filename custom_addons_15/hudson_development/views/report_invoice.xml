<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

         <record id="ir_hud_dev" model="ir.actions.report">
            <field name="name">Invoice GST Report - Premix</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">hudson_development.report_custom_invoice</field>
            <field name="report_file">hudson_development.report_custom_invoice</field>
            <field name="binding_model_id" ref="account.model_account_move"/>
            <field name="binding_type">report</field>
        </record>

        <template id="report_custom_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <style>
                                th,
                                td {
                                    padding: 5px !important;
                                    font-size: 13px;
                                }

                                .mb64 {
                                    margin-bottom: 64px !important
                                }

                                .mt96 {
                                    margin-top: 96px !important
                                }
                            </style>
                            <h2>
                                <span t-if="o.move_type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')">Invoice</span>
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                                <span t-if="o.move_type == 'out_refund'">Credit Note</span>
                                <span t-if="o.move_type == 'in_refund'">Vendor Credit Note</span>
                                <span t-if="o.move_type == 'in_invoice'">Vendor Bill</span>
                                <span t-field="o.name" />
                            </h2>
                            <div class="row mt16">
                                <div class="col-12">
                                    <p t-field="o.partner_id" />
                                    <p t-esc="o.partner_id.street">
                                        <span t-if="o.partner_id.street">,</span>
                                    </p>
                                    <span t-esc="o.partner_id.city" />
                                </div>
                            </div>
                            <div t-if="o.partner_id" class="row mt32 mb32">
                                <div class="col-2">
                                    <strong>NTN:</strong>
                                    <p t-field="o.partner_id.vat" />
                                </div>
                                <div class="col-2">
                                    <strong>CNIC:</strong>
                                    <p t-field="o.partner_id.x_cnic" />
                                </div>
                                <div class="col-2">
                                    <strong>ST NO:</strong>
                                    <p t-field="o.partner_id.x_studio_field_8AoVj" />
                                </div>
                            </div>
                            <div class="row mt32 mb32">
                                <div class="col-2" t-if="o.name">
                                    <strong>Description:</strong>
                                    <p t-field="o.name" />
                                </div>
                                <div class="col-2" t-if="o.date">
                                    <strong>Invoice Date:</strong>
                                    <p t-field="o.invoice_date" />
                                </div>
                                <div class="col-2" t-if="o.date">
                                    <span t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                        <strong>PO Name:</strong>
                                    </span>
                                    <span t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                        <strong>SO Name:</strong>
                                    </span>
                                    <p t-field="o.invoice_origin" />
                                </div>
                                <!--<div class="col-2" t-if="o.date_due and o.type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')"><strong>Due Date:</strong><p t-field="o.date_due"/></div>-->
                                <t t-set="i" t-value="0" />
                                <t t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                    <t t-foreach="o.invoice_line_ids" t-as="l">
                                        <t t-set="i" t-value="env['stock.move.line'].search(['&amp;',('picking_id.origin','=',o.invoice_origin),('product_id.id','=',l.product_id.id)])" /></t>
                                    <t t-set="i_cnt" t-value="0" />
                                    <t t-foreach="i" t-as="c">
                                        <t t-set="i_cnt" t-value="i_cnt+1" /></t>
                                </t>
                                <div class="col-2" t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                    <t t-if="i">
                                        <strong>DC Number:</strong>
                                        <p t-esc="i[i_cnt-1].picking_id.name" />
                                    </t>
                                </div>
                                <div class="col-2" t-if="o.partner_id.ref">
                                    <strong>Customer Code:</strong>
                                    <p t-field="o.partner_id.ref" />
                                </div>
                                <div name="reference" class="col-2" t-if="o.ref">
                                    <strong>Reference:</strong>
                                    <p t-field="o.ref" />
                                </div>
                            </div>
                            <t t-set="s_order" />
                            <t t-if="o.invoice_origin">
                                <t t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                    <t t-set="s_order" t-value="env['sale.order'].search([('name','=',o.invoice_origin)])" /></t>
                            </t>
                            <!-- Is there a discount on at least one line? -->
                            <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])" />
                            <t t-set="totalGst" t-value="0" />
                            <table class="table table-condensed" name="invoice_line_table">
                                <thead>
                                    <tr>
                                        <th t-if="o.partner_id.x_studio_partner_type == 'Customer'">Product Code</th>
                                        <th>Product</th>
                                        <th>Description</th>
                                        <th class="hidden">Source Document</th>
                                        <t t-if="o.invoice_origin">
                                            <t t-if="o.partner_id.x_studio_partner_type == 'Customer' and s_order.x_ByAmpoule == true">
                                                <th>Ampoule Quantity</th>
                                                <th>Ampoule Price</th>
                                            </t>
                                        </t>
                                        <th t-if="o.partner_id.x_studio_partner_type == 'Supplier'">Warehouse In #</th>
                                        <th t-if="o.partner_id.x_studio_partner_type == 'Supplier'">Warehouse In Date</th>
                                        <th class="text-center">Quantity</th>
                                        <th t-if="o.partner_id.x_studio_partner_type == 'Customer'" class="text-center">Batch</th>
                                        <th class="text-center">Unit Price</th>
                                        <th t-if="display_discount" class="text-center">Disc.(%)</th>
                                        <th t-if="o.partner_id.x_studio_partner_type == 'Supplier'" class="text-center">Taxes</th>
                                        <th class="text-center">Amount without Tax</th>
                                        <th class="text-center">GST Amount</th>
                                        <th class="text-center">Further Tax</th>
                                        <th class="text-center">Amount with Tax</th>
                                    </tr>
                                </thead>
                                <tbody class="invoice_tbody">
                                    <tr t-foreach="o.invoice_line_ids" t-as="l">
                                        <t t-set="sp" t-value="env['stock.move.line'].search(['&amp;',('picking_id.origin','=',o.invoice_origin),('product_id.id','=',l.product_id.id),('move_id.product_qty','=',l.quantity)])" />
                                        <t t-set="cnt" t-value="0" />
                                        <t t-foreach="sp" t-as="c">
                                            <t t-set="cnt" t-value="cnt+1" />
                                        </t>
                                        <td t-if="o.partner_id.x_studio_partner_type == 'Customer'" class="text-left">
                                            <span t-if="o.partner_id.x_studio_partner_type == 'Customer'" t-esc="l.product_id.default_code" />
                                            <span t-if="not l.product_id.default_code">I-
                                                <span t-esc="l.product_id.id"/></span>
                                        </td>
                                        <td>
                                            <span t-esc="l.product_id.name" />
                                        </td>
                                        <td>
                                            <!-- <span t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                                <t t-esc="l.name"/>
                                            </span>
                                            <span t-foreach="l.product_id.product_template_attribute_value_ids" t-as="t">
                                                <t t-if="t.attribute_id.id in [1,3]">
                                                    <span t-esc="t.name"/>
                                                </t>
                                            </span> -->
                                            <t t-esc="l.name" />
                                        </td>
                                        <td class="hidden">
                                            <span t-field="o.invoice_origin" />
                                        </td>
                                        <t t-if="o.invoice_origin">
                                            <t t-if="o.partner_id.x_studio_partner_type == 'Customer' and s_order.x_ByAmpoule == true">
                                                <td class="text-right">
                                                    <span t-esc="round(l.quantity*l.product_id.x_PerPackQuant)" />
                                                    <span t-field="l.uom_id" groups="product.group_uom" />
                                                </td>
                                                <td class="text-right">
                                                    <span t-esc="l.price_unit/l.product_id.x_PerPackQuant" />
                                                </td>
                                            </t>
                                        </t>
                                        <td t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                            <t t-if="sp">
                                                <span t-esc="sp[cnt-1].move_id.reference" />
                                            </t>
                                            <t t-else="">
                                                <span>N/A</span>
                                            </t>
                                        </td>
                                        <td t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                            <t t-if="sp">
                                                <span t-esc="datetime.datetime.strptime(str(sp[cnt-1].date), '%Y-%m-%d %H:%M:%S').strftime('%d/%m/%Y')" />
                                            </t>
                                            <t t-else="">
                                                <span>N/A</span>
                                            </t>
                                        </td>
                                        <td class="text-right">
                                            <span t-if="o.partner_id.x_studio_partner_type == 'Customer'" t-esc="round(l.quantity)" />
                                            <span t-if="o.partner_id.x_studio_partner_type == 'Supplier'" t-esc="l.quantity" />
                                            <span t-field="l.uom_id" groups="product.group_uom" />
                                        </td>
                                        <td t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                            <t t-if="o.invoice_line_ids">
                                                <t t-foreach="o.invoice_line_ids" t-as="ll">
                                                    <!--<t t-set="batchNo" t-value="env['stock.move.line'].search([('move_id.origin_returned_move_id','=',row.move_id.id)])"/>-->
                                                    <!-- <t t-if="batchNo">-->
                                                    <!-- </t>-->
                                                    <!-- <t t-else="">-->
                                                    <!--   <t t-esc="str(row.lot_id.name)+', '"/>-->
                                                    <!-- </t> -->
                                                    <t t-if="o.partner_id.x_studio_partner_type == 'Customer'">
                                                        <span t-if="ll.x_lot_id" t-esc="ll.x_lot_id.name.split(' ')[0]" />
                                                    </t>
                                                </t>
                                                <!-- <span t-if="sp[cnt-1].lot_id.name" t-esc="', '.join(map(lambda x: (x.lot_id.name.split(' ')[0]), sp))"/><span t-if="not sp[cnt-1].lot_id.name">-</span>-->
                                            </t>
                                            <span t-if="not sp">NA</span>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="l.price_unit" />
                                        </td>
                                        <td t-if="display_discount" class="text-right">
                                            <span t-field="l.discount" />
                                        </td>
                                        <td t-if="o.partner_id.x_studio_partner_type == 'Supplier'" class="text-right">
                                            <span t-esc="', '.join(map(lambda x: (x.description or x.name), l.tax_ids))" />
                                        </td>
                                        <td class="text-right" id="subtotal">
                                            <span t-field="l.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                        </td>
                                        <td>
                                            <t t-foreach="l.tax_ids" t-as="taxLine">
                                                <t t-if="taxLine.x_studio_gst_tax == True">
                                                    <span t-esc="'{0:,.2f}'.format(taxLine.amount*l.quantity)"></span>
                                                    <t t-set="totalGst" t-value="totalGst+(taxLine.amount*l.quantity)" />
                                                </t>

                                            </t>
                                        </td>
                                        <td><span>0.0</span></td>
                                        <td>
                                            <t t-foreach="l.tax_ids" t-as="taxLine">
                                                <t t-if="taxLine.x_studio_gst_tax == True">
                                                    <span t-esc="'{0:,.2f}'.format((taxLine.amount*l.quantity)+l.price_subtotal)"></span>
                                                </t>
                                            </t>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="clearfix">
                                <div id="total" class="row">
                                    <div class="col-8" />
                                    <div class="col-4 ">
                                        <table t-if="o.partner_id.x_studio_partner_type == 'Supplier'" class="table table-condensed" style="min-width: 250px;max-width: 400px;">
                                            <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                                <td>
                                                    <strong>Untaxed Amount</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                </td>
                                            </tr>
                                            <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                                <td>
                                                    <strong>Tax</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.amount_tax" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                </td>
                                            </tr>
                                            <tr class="border-black">
                                                <td>
                                                    <strong>Total</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-field="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                </td>
                                            </tr>
                                        </table>
                                        <table t-else="" class="table table-condensed" style="min-width: 250px;max-width: 400px;">
                                            <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                                <td>
                                                    <strong>Subtotal (Including GST)</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-esc="'{0:,.2f}'.format(totalGst+o.amount_untaxed)"></span>
                                                    <!--<span t-field="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                                </td>
                                            </tr>
                                            <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                                <td>
                                                    <strong>Advance Income Tax:</strong>
                                                </td>
                                                <td class="text-right">
                                                    <span t-esc="o.amount_tax-totalGst" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></span>
                                                    <!--<span t-field="o.amount_tax" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                                </td>
                                            </tr>
                                            <tr class="border-black">
                                                <td>
                                                    <strong>Total</strong>
                                                </td>
                                                <td class="text-right">
                                                    <!--<t t-set="TotalAmtWithTax" t-value="o.amount_untaxed+o.amount_tax"/><span t-esc="TotalAmtWithTax"></span>-->
                                                    <span t-esc="o.amount_untaxed+o.amount_tax" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                <table t-if="o.line_ids" class="table table-condensed" name="invoice_line_table">
                                    <thead>
                                        <tr>
                                            <th>Account</th>
                                            <th>Analytic Account</th>
                                            <th class="text-right">Debit</th>
                                            <th class="text-right">Credit</th>
                                        </tr>
                                    </thead>
                                    <tbody class="invoice_tbody">
                                        <tr t-foreach="o.line_ids" t-as="l">
                                            <td>
                                                <span t-field="l.account_id" />
                                            </td>
                                            <td>
                                                <span t-field="l.analytic_account_id" />
                                            </td>
                                            <td class="text-right">
                                                <span t-field="l.debit" />
                                            </td>
                                            <td class="text-right">
                                                <span t-field="l.credit" />
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!--<p t-if="o.narration">-->
                            <!--    <span t-field="o.narration"/>-->
                            <!--</p>-->
                            <!--<p t-if="o.invoice_payment_term_id">-->
                            <!--    <span t-field="o.invoice_payment_term_id.note"/>-->
                            <!--</p>-->
                            <!--<p t-if="o.fiscal_position_id.note">-->
                            <!--    <span t-field="o.fiscal_position_id.note"/>-->
                            <!--</p>-->
                            <div class="row mb64 mt96" t-if="o.partner_id.x_studio_partner_type == 'Supplier'">
                                <div class="col-3">
                                    <div class="col-12">
                                        <u t-field="o.create_uid" />
                                    </div>
                                    <div class="col-12">
                                        <strong>Prepared By</strong>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="col-12">
                                        <t t-if="env['mail.tracking.value'].search(['&amp;',('mail_message_id.res_id','=',o.id),('mail_message_id.model','=','account.invoice'),('new_value_char','=','Open')])">
                                            <u t-field="env['mail.tracking.value'].search(['&amp;',('mail_message_id.res_id','=',o.id),('mail_message_id.model','=','account.invoice'),('new_value_char','=','Open')])[0].mail_message_id.author_id" />
                                        </t>
                                    </div>
                                    <div class="col-12">
                                        <strong>Validated By</strong>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="col-12">
                                        <strong>_______________</strong>
                                    </div>
                                    <div class="col-12">
                                        <strong>Checked By</strong>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="col-12">
                                        <strong>_______________</strong>
                                    </div>
                                    <div class="col-12">
                                        <strong>Director</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
</template>



    </data>
</odoo>